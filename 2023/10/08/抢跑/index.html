<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>抢跑 | Q1ngying</title><meta name="author" content="Q1ngying"><meta name="copyright" content="Q1ngying"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言： 可以说，抢跑是智能合约攻击中非常常见的攻击手法">
<meta property="og:type" content="article">
<meta property="og:title" content="抢跑">
<meta property="og:url" content="https://q1ngying.cn/2023/10/08/%E6%8A%A2%E8%B7%91/index.html">
<meta property="og:site_name" content="Q1ngying">
<meta property="og:description" content="前言： 可以说，抢跑是智能合约攻击中非常常见的攻击手法">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://q1ngying.cn/img/butterfly-icon.jpg">
<meta property="article:published_time" content="2023-10-08T06:23:38.000Z">
<meta property="article:modified_time" content="2023-11-06T11:46:23.689Z">
<meta property="article:author" content="Q1ngying">
<meta property="article:tag" content="Solidity">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://q1ngying.cn/img/butterfly-icon.jpg"><link rel="shortcut icon" href="/img/icons8-clover-ios-16-glyph-32.png"><link rel="canonical" href="https://q1ngying.cn/2023/10/08/%E6%8A%A2%E8%B7%91/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><meta name="google-site-verification" content="IzCM4B791_p7IAU4WhRfiLlPBnODnamJ7ixKxzoeNfk"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '抢跑',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-06 19:46:23'
}</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/butterfly-icon.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">76</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">29</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/back1.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Q1ngying</span></a><a class="nav-page-title" href="/"><span class="site-name">抢跑</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">抢跑</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-08T06:23:38.000Z" title="发表于 2023-10-08 14:23:38">2023-10-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-06T11:46:23.689Z" title="更新于 2023-11-06 19:46:23">2023-11-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Security/">Security</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">2.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><strong>前言：</strong></p>
<p>可以说，抢跑是智能合约攻击中非常常见的攻击手法</p>
<span id="more"></span>
<h1 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h1><p>想要了解抢跑攻击，必须先了解以太坊的交易流程：</p>
<p><img src="../images/抢跑/640.png" alt="图片"></p>
<p>可以看到图中一笔交易从签名被打包一共会经历 7 个阶段：</p>
<ul>
<li>使用私钥对交易内容签名</li>
<li>选择 Gas Price</li>
<li>发送签名后的交易</li>
<li>交易在各个节点之间广播</li>
<li>交易进入交易池</li>
<li>矿工取出 Gas Price 高的交易</li>
<li>矿工打包交易并出块</li>
</ul>
<p><strong>交易发送后会被丢进交易池中，等待被矿工打包。矿工从交易池中取出交易进行打包与出块。</strong>根据 Etherscan 的数据，目前区块 Gas 限制在 3000w 左右，这是一个动态调整的值。若有一笔基础交易 21000 Gas 来计算，则目前一个以太坊区块可以容纳 1428 笔交易。因此，当交易池中的交易量大时，会有许多交易没办法即使被打包而滞留在交易池中等待。</p>
<p><strong><em>交易池中存在多笔交易，矿工有限打包哪笔交易？</em></strong></p>
<p>矿工节点可以自行设置参数，不过大多数矿工都是按照手续费的多少排序，手续费高的会被优先打包出块，手续费低的则需要等前面手续费高的交易全部打包完成后才能会被打包。<strong>进入交易池中的交易是源源不断的，不管交易进入交易池时间的先后，手续费高的永远会优先打包，手续费过低的可能永远不会被打包</strong></p>
<p><strong><em>手续费是怎么来的？</em></strong></p>
<p>以太坊手续续费计算公式：</p>
<p>Tx Fee（手续费） = Gas Used *  Gas Price</p>
<p>其中 Gas Used 是由系统计算得出的，Gas Price 是可以自定义的，所以最终手续费的多少取决于 Gas Price 设置的多少</p>
<p>举个例子：</p>
<p>例如 Gas Price 设置为 10 GWEI，Gas Used 为 21,000（WEI 是以太坊上最小的单位 1 WEI = 10^-18 个 Ether，GWEI 则是 1G 的 WEI，1 GWEI = 10^-9 个 Ether）。因此，根据手续费计算公式可以算出手续费为：</p>
<p>10 GWEI（单位燃料价格）* 21,000（燃料用量）= 0.00021 Ether（手续费）</p>
<p>在合约中我们常见到 Call 函数会设置 Gas Limit，下面我们来看看它是什么东西：</p>
<p>Gas Limit 可以从字面意思理解，就是 Gas 限制的意思，设置它是为了表示你愿意花多少数量的 Gas 在这笔交易上。当交易涉及复杂的合约交互时，不太确定实际的 Gas Used，可以设置 Gas Limit，被打包时只会收取实际 Gas Used 作为手续费，多给的 Gas 会退返回来，当然如果实际操作中 Gas Used &gt; Gas Limit 就会发生 Out of gas，造成交易回滚。</p>
<p>当然，在实际交易中选择一个合适的 Gas Price 也是有讲究的，我们可以在 ETH GAS STATION 上看到实时的 Gas Price 对应的打包速度：</p>
<p><img src="../images/抢跑/640-16967474444573.png" alt="图片"></p>
<p>由上图可见，当前最快的打包速度对应的 Gas Price 为 2，我们只需要在发送交易时将 Gas Price 设置为 &gt;= 2 的值就可以被尽快打包。</p>
<p>好了，到这里相信大家已经可以大致猜出抢跑的攻击方式了，就是在发送交易时将 Gas Price 调高从而被矿工优先打包。下面我们还是通过一个合约代码来带大家了解抢跑是如何完成攻击的。</p>
<h1 id="合约示例"><a href="#合约示例" class="headerlink" title="合约示例"></a>合约示例</h1><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">//SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.17</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">"github.com/OpenZeppelin/openzeppelin-contracts/blob/release-v4.5/contracts/utils/Strings.sol"</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">SecuredFindThisHash</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//Struct is used to store the commit details</span>
	<span class="token keyword">struct</span> <span class="token class-name">Commit</span> <span class="token punctuation">&#123;</span>
        <span class="token builtin">bytes32</span> solutionHash<span class="token punctuation">;</span>
        <span class="token builtin">uint</span> commitTime<span class="token punctuation">;</span>
        <span class="token builtin">bool</span> revealed<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">// The hash that is needed to be solved</span>
	<span class="token builtin">bytes32</span> <span class="token keyword">public</span> hash <span class="token operator">=</span> <span class="token number">0x564ccaf7594d66b1eaaea24fe01f0585bf52ee70852af4eac0cc4b04711cd0e2</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Address of the winner</span>
	<span class="token builtin">address</span> <span class="token keyword">public</span> winner<span class="token punctuation">;</span>
	
	<span class="token comment">// Price to be rewarded</span>
	<span class="token builtin">uint</span> <span class="token keyword">public</span> reward<span class="token punctuation">;</span>
	
	<span class="token comment">// Status of game</span>
	<span class="token builtin">bool</span> <span class="token keyword">public</span> ended<span class="token punctuation">;</span>
	
	<span class="token comment">// Mapping to store the commit details with address</span>
	<span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> Commit<span class="token punctuation">)</span> commits<span class="token punctuation">;</span>
	
	<span class="token comment">// Modifier to check if the game is active</span>
	<span class="token keyword">modifier</span> <span class="token function">gameActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token operator">!</span>ended<span class="token punctuation">,</span><span class="token string">"Already ended"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">_</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>
		reward <span class="token operator">=</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	    <span class="token comment">/* 
       		Commit function to store the hash calculated using keccak256(address in lowercase + solution + secret). 
       		Users can only commit once and if the game is active.
    	*/</span>
	<span class="token keyword">function</span> <span class="token function">commitSolution</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span> _solutionHash<span class="token punctuation">)</span> <span class="token keyword">public</span> gameActive <span class="token punctuation">&#123;</span>
	Commit <span class="token keyword">storage</span> commit <span class="token operator">=</span> commits<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span>commit<span class="token punctuation">.</span>commitTime <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"Already committed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	commit<span class="token punctuation">.</span>solutionHash <span class="token operator">=</span> _solutionHash<span class="token punctuation">;</span>
	commit<span class="token punctuation">.</span>commitTime <span class="token operator">=</span> block<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>
	commit<span class="token punctuation">.</span>revealed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">/* 
        Function to get the commit details. It returns a tuple of (solutionHash, commitTime, revealStatus);  
        Users can get solution only if the game is active and they have committed a solutionHash
    */</span>
	<span class="token keyword">function</span> <span class="token function">getMySolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> gameActive <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span><span class="token punctuation">,</span> <span class="token builtin">uint</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	Commit <span class="token keyword">storage</span> commit <span class="token operator">=</span> commits<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span>commit<span class="token punctuation">.</span>commitTime <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"Not committed yet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>commit<span class="token punctuation">.</span>solutionHash<span class="token punctuation">,</span> commit<span class="token punctuation">.</span>commitTime<span class="token punctuation">,</span> commit<span class="token punctuation">.</span>revealed<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">/* 
        Function to reveal the commit and get the reward. 
        Users can get reveal solution only if the game is active and they have committed a solutionHash before this block and not revealed yet.
        It generates an keccak256(msg.sender + solution + secret) and checks it with the previously commited hash.  
        Front runners will not be able to pass this check since the msg.sender is different.
        Then the actual solution is checked using keccak256(solution), if the solution matches, the winner is declared, 
        the game is ended and the reward amount is sent to the winner.
    */</span>
	<span class="token keyword">function</span> <span class="token function">revealSolution</span><span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span> _solution<span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token keyword">memory</span> _secret<span class="token punctuation">)</span> <span class="token keyword">public</span> gameActive <span class="token punctuation">&#123;</span>
	Commit <span class="token keyword">storage</span> commit <span class="token operator">=</span> commits<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span>commit<span class="token punctuation">.</span>commitTime <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"Not commit yet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span>commit<span class="token punctuation">.</span>commitTime <span class="token operator">&lt;</span> block<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span> <span class="token string">"Cannot reveal in the same block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token operator">!</span>commit<span class="token punctuation">.</span>revealed<span class="token punctuation">,</span><span class="token string">"Already commited and revealed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token builtin">bytes32</span> solutionHash <span class="token operator">=</span> <span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>Strings<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">,</span> _solution<span class="token punctuation">,</span> _secret<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span>solutionHash <span class="token operator">==</span> commit<span class="token punctuation">.</span>solutionHash<span class="token punctuation">,</span><span class="token string">"Hash doesn't match"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>_solution<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> hash<span class="token punctuation">,</span> <span class="token string">"Incorrect answer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	winner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
	ended <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	
	<span class="token punctuation">(</span><span class="token builtin">bool</span> sent<span class="token punctuation">,</span> <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">payable</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">&#123;</span>value<span class="token punctuation">:</span> reward<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>sent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        winner <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    ended <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	    <span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token string">"Failed to send ether."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="攻击分析"><a href="#攻击分析" class="headerlink" title="攻击分析"></a>攻击分析</h2><p>通过合约代码可以看到 FindThisHash 合约的部署者给出了一个哈希值，任何人都可以通过<code>solve()</code>提交答案，只要 solution 的哈希值与部署者的哈希值相同就可以得到 10 个以太的奖励。我们这里排除部署者自己拿取奖励的可能。</p>
<p>我们还是请出老朋友 Eve（攻击者） 看看他是如何使用抢跑攻击拿走本该属于 Bob（受害者）的奖励的：</p>
<ol>
<li><p>Alice（合约部署者）使用 10 Ether 部署 FindThisHash 合约；</p>
</li>
<li><p>Bob 找到哈希值为目标哈希值的正确字符串；</p>
</li>
<li><p>Bob 调用 solve(“Ethereum”) 并将 Gas 价格设置为 15 Gwei；</p>
</li>
<li><p>Eve 正在监控交易池，等待有人提交正确的答案；</p>
</li>
<li><p>Eve 看到 Bob 发送的交易，设置比 Bob 更高的 Gas Price（100 Gwei），调用 solve(“Ethereum”)；</p>
</li>
<li><p>Eve 的交易先于 Bob 的交易被矿工打包；</p>
</li>
<li><p>Eve 赢得了 10 个以太币的奖励。</p>
</li>
</ol>
<p>这里 Eve 的一系列操作就是标准的抢跑攻击，我们这里就可以给以太坊中的抢跑下一个定义：<strong>抢跑就是通过设置更高的 Gas Price 来影响交易被打包的顺序，从而完成攻击</strong>。</p>
<p>那么这类攻击该如何避免呢？</p>
<h2 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h2><p>在编写合约时可以使用 Commit-Reveal 方案：</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/swlh/exploring-commit-reveal-schemes-on-ethereum-c4ff5a777db8">https://medium.com/swlh/exploring-commit-reveal-schemes-on-ethereum-c4ff5a777db8</a></p>
<p><em>Solidity by Example</em> 中提供了下面这段修复代码：</p>
<pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">//SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.17</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">"github.com/OpenZeppelin/openzeppelin-contracts/blob/release-v4.5/contracts/utils/Strings.sol"</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">SecuredFindThisHash</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//Struct is used to store the commit details</span>
	<span class="token keyword">struct</span> <span class="token class-name">Commit</span> <span class="token punctuation">&#123;</span>
        <span class="token builtin">bytes32</span> solutionHash<span class="token punctuation">;</span>
        <span class="token builtin">uint</span> commitTime<span class="token punctuation">;</span>
        <span class="token builtin">bool</span> revealed<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">// The hash that is needed to be solved</span>
	<span class="token builtin">bytes32</span> <span class="token keyword">public</span> hash <span class="token operator">=</span> <span class="token number">0x564ccaf7594d66b1eaaea24fe01f0585bf52ee70852af4eac0cc4b04711cd0e2</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Address of the winner</span>
	<span class="token builtin">address</span> <span class="token keyword">public</span> winner<span class="token punctuation">;</span>
	
	<span class="token comment">// Price to be rewarded</span>
	<span class="token builtin">uint</span> <span class="token keyword">public</span> reward<span class="token punctuation">;</span>
	
	<span class="token comment">// Status of game</span>
	<span class="token builtin">bool</span> <span class="token keyword">public</span> ended<span class="token punctuation">;</span>
	
	<span class="token comment">// Mapping to store the commit details with address</span>
	<span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> Commit<span class="token punctuation">)</span> commits<span class="token punctuation">;</span>
	
	<span class="token comment">// Modifier to check if the game is active</span>
	<span class="token keyword">modifier</span> <span class="token function">gaameActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token operator">!</span>ended<span class="token punctuation">,</span><span class="token string">"Already ended"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">_</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>
		reward <span class="token operator">=</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	    <span class="token comment">/* 
       		Commit function to store the hash calculated using keccak256(address in lowercase + solution + secret). 
       		Users can only commit once and if the game is active.
    	*/</span>
	<span class="token keyword">function</span> <span class="token function">commitSolution</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span> _solutionHash<span class="token punctuation">)</span> <span class="token keyword">public</span> gameActive <span class="token punctuation">&#123;</span>
	Commit <span class="token keyword">storage</span> commit <span class="token operator">=</span> commits<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span>commit<span class="token punctuation">.</span>commitTime <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"Already committed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	commit<span class="token punctuation">.</span>solutionHash <span class="token operator">=</span> _solutionHash<span class="token punctuation">;</span>
	commit<span class="token punctuation">.</span>commitTime <span class="token operator">=</span> block<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>
	commit<span class="token punctuation">.</span>revealed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">/* 
        Function to get the commit details. It returns a tuple of (solutionHash, commitTime, revealStatus);  
        Users can get solution only if the game is active and they have committed a solutionHash
    */</span>
	<span class="token keyword">function</span> <span class="token function">getMySolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> gameActive <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span><span class="token punctuation">,</span> <span class="token builtin">uint</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	Commit <span class="token keyword">storage</span> commit <span class="token operator">=</span> commits<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span>commit<span class="token punctuation">.</span>commitTime <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"Not committed yet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>commit<span class="token punctuation">.</span>solutionHash<span class="token punctuation">,</span> commit<span class="token punctuation">.</span>commitTime<span class="token punctuation">,</span> commit<span class="token punctuation">.</span>revealed<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">/* 
        Function to reveal the commit and get the reward. 
        Users can get reveal solution only if the game is active and they have committed a solutionHash before this block and not revealed yet.
        It generates an keccak256(msg.sender + solution + secret) and checks it with the previously commited hash.  
        Front runners will not be able to pass this check since the msg.sender is different.
        Then the actual solution is checked using keccak256(solution), if the solution matches, the winner is declared, 
        the game is ended and the reward amount is sent to the winner.
    */</span>
	<span class="token keyword">function</span> <span class="token function">revealSolution</span><span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span> _solution<span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token keyword">memory</span> _secret<span class="token punctuation">)</span> <span class="token keyword">public</span> gameActive <span class="token punctuation">&#123;</span>
	Commit <span class="token keyword">storage</span> commit <span class="token operator">=</span> commits<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span>commit<span class="token punctuation">.</span>commitTime <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"Not commit yet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span>commit<span class="token punctuation">.</span>commitTime <span class="token operator">&lt;</span> block<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span> <span class="token string">"Cannot reveal in the same block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token operator">!</span>commit<span class="token punctuation">.</span>revealed<span class="token punctuation">,</span><span class="token string">"Already commited and revealed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token builtin">bytes32</span> solutionHash <span class="token operator">=</span> <span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">,</span> _solution<span class="token punctuation">,</span> _secret<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">require</span><span class="token punctuation">(</span>solutionHash <span class="token operator">==</span> commit<span class="token punctuation">.</span>solutionHash<span class="token punctuation">,</span><span class="token string">"Hash doesn't match"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>_solution<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> hash<span class="token punctuation">,</span> <span class="token string">"Incorrect answer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	winner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
	ended <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	
	<span class="token punctuation">(</span><span class="token builtin">bool</span> sent<span class="token punctuation">,</span> <span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">payable</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">&#123;</span>value<span class="token punctuation">:</span> reward<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	winner <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ended <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">revert</span><span class="token punctuation">(</span><span class="token string">"Failed to send ether."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>首先，在修复代码中使用了结构体 Commit 记录玩家提交的信息，其中：</p>
<p>commit.solutionHash = _solutionHash = keccak256(玩家地址 + 答案 + 密码) [记录玩家提交的答案哈希]</p>
<p>commit.commitTime = block.timestamp [记录提交时间]</p>
<p>commit.revealed = false [记录状态]</p>
<p>下面我们来看这个合约是如何运作的：</p>
<ol>
<li>Alice 使用十个以太部署 SecuredFindThisHash 合约；</li>
<li>Bob 找到哈希值为目标哈希值的正确字符串</li>
<li>Bob 计算 solutionHash = keccak256(Bob’s Address + “Ethereum” + Bob’s secret);</li>
<li>Bob 调用 commitSolution(_solutionHash)，提交刚刚算出的 solutionHash；</li>
<li>Bob 在下个区块调用 revealSolution(“Ethereum”, Bob’s secret) 函数，传入答案和自己的密码，领取奖励。</li>
</ol>
<p>这里我们看到了上述合约如何避免抢跑的，首先在第四步，Bob 提交的是 <code>Bob&#39;s Address + &quot;Ethereum&quot; + Bob&#39;s secret</code> 这三个值的哈希，所以没有人知道 Bob 提交的内容到底是什么，还进一步记录了提交的区块时间并且在第五步的 revealSolution() 中就先检查了区块时间，这是为了防止在同一个区块开奖被抢跑，因为调用 revealSolution() 时需要传入明文答案，最后使用 Bob 输入的答案和密码验证值卡提交的 solutionHash 哈希是否匹配，这一步是为了防止有人不走 commitSolution() 直接去调用 revealSolution()。验证成功后，检查答案是否正确，最后发放奖励。</p>
<p><strong><em>所以这个合约真的完美地防止了 Eve 抄答案吗？</em></strong></p>
<p>Of course not！</p>
<p>咋回事呢？我们看到在 revealSolution() 中仅限制了 commit.commitTime &lt; block.timestamp ，所以假设 Bob 在第一个区块提交了答案，在第二个区块立马调用 revealSolution(“Ethereum”,Bob’s secret) 并设置 Gas Price = 15 Gwei ，Eve 通过监控交易池拿到答案，拿到答案后他立即设置 Gas Price = 100 Gwei ，在第二个区块中调用 commitSolution() ，提交答案并构造多笔高 Gas Price 的交易，将第二个区块填满，从而将 Bob 提交的交易挤到第三个区块中。在第三个区块中以 100 Gwei 的 Gas Price 调用 revealSolution(“Ethereum”,Eve’s secret) ，得到奖励。</p>
<p>那么问题来了，如何才能有效地防止此类攻击呢？</p>
<p>很简单，只需要设置 uint256 revealSpan 值并在 commitSolution() 中检查 require(commit.commitTime + revealSpan &gt;= block.timestamp, “Cannot commit in this block”);，这样就可以防止 Eve 抄答案的情况。但是在开奖的时候，还是无法防止提交过答案的人抢先领奖。</p>
<p>另外还有一点，本着代码严谨性，修复代码中的 revealSolution() 函数执行完后并没有将 commit.revealed 设为 True，虽然这并不会影响什么，但是在编写代码的时候还是建议养成良好的编码习惯，执行完函数逻辑后将开关设置成正确的状态。</p>
<p>来源：慢雾公众号</p>
<p>链接：</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzU4ODQ3NTM2OA==&amp;mid=2247497405&amp;idx=1&amp;sn=b215346b43437ed18a5e67a556d5c814&amp;chksm=fdde883acaa9012cdfc683b01171acbfc66802e9745d3732c3344b69f76ea0c56ea58cbeda19&amp;scene=178&amp;cur_album_id=1378653641065857025#rd">https://mp.weixin.qq.com/s?__biz=MzU4ODQ3NTM2OA==&amp;mid=2247497405&amp;idx=1&amp;sn=b215346b43437ed18a5e67a556d5c814&amp;chksm=fdde883acaa9012cdfc683b01171acbfc66802e9745d3732c3344b69f76ea0c56ea58cbeda19&amp;scene=178&amp;cur_album_id=1378653641065857025#rd</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://q1ngying.cn">Q1ngying</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://q1ngying.cn/2023/10/08/%E6%8A%A2%E8%B7%91/">https://q1ngying.cn/2023/10/08/%E6%8A%A2%E8%B7%91/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://q1ngying.cn" target="_blank">Q1ngying</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Solidity/">Solidity</a><a class="post-meta__tags" href="/tags/Security/">Security</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="prev-post pull-left" href="/2023/10/08/solidity%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E7%9B%B8%E5%85%B3/" title="solidity类型转换相关"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">solidity类型转换相关</div></div></a><a class="next-post pull-right" href="/2023/10/08/%E9%87%8D%E6%94%BE/" title="重放"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">重放</div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a href="/2023/09/26/Contract-Size-Check/" title="Contract Size Check"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-26</div><div class="title">Contract Size Check</div></div></a><a href="/2023/11/06/%E7%99%BB%E9%93%BE-%E7%AC%AC%E4%B8%80%E8%AF%BE/" title="登链-第一课"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-06</div><div class="title">登链-第一课</div></div></a><a href="/2023/11/06/%E7%99%BB%E9%93%BE-%E7%AC%AC%E4%BA%8C%E8%AF%BE/" title="登链-第二课"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-06</div><div class="title">登链-第二课</div></div></a><a href="/2024/03/30/%E9%87%8D%E5%85%A5/" title="重入"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-30</div><div class="title">重入</div></div></a><a href="/2023/10/08/%E9%87%8D%E6%94%BE/" title="重放"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-08</div><div class="title">重放</div></div></a><a href="/2023/11/06/DeFi%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="DeFi基础概念"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-06</div><div class="title">DeFi基础概念</div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info is-center"><div class="avatar-img"><img src="/img/butterfly-icon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Q1ngying</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">76</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">29</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/q1ngying"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/q1ngying" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://weibo.com" target="_blank" title="微博"><i class="fab fa-weibo" style="color: #24292e;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%88%E7%BA%A6%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.</span> <span class="toc-text">合约示例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E5%88%86%E6%9E%90"><span class="toc-number">2.1.</span> <span class="toc-text">攻击分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.2.</span> <span class="toc-text">修复建议</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/17/MakerDAO-Abacus/" title="MakerDAO-Abacus">MakerDAO-Abacus</a><time datetime="2024-07-17T07:06:42.000Z" title="发表于 2024-07-17 15:06:42">2024-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/17/MakerDAO-Clip/" title="MakerDAO-Clip">MakerDAO-Clip</a><time datetime="2024-07-17T07:06:32.000Z" title="发表于 2024-07-17 15:06:32">2024-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/15/MakerDAO-Join/" title="MakerDAO-Join">MakerDAO-Join</a><time datetime="2024-07-15T07:34:45.000Z" title="发表于 2024-07-15 15:34:45">2024-07-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/15/MakerDAO-Vat/" title="MakerDAO-Vat">MakerDAO-Vat</a><time datetime="2024-07-15T07:34:34.000Z" title="发表于 2024-07-15 15:34:34">2024-07-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/06/11/Storage%20%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94%E9%80%9A%E8%BF%87%E5%BC%95%E7%94%A8%20Storage%20%E6%8F%90%E9%AB%98%20gas%20%E5%88%A9%E7%94%A8%E7%8E%87/" title="Storage 进阶——通过引用 Storage 提高 gas 利用率">Storage 进阶——通过引用 Storage 提高 gas 利用率</a><time datetime="2024-06-11T09:13:23.000Z" title="发表于 2024-06-11 17:13:23">2024-06-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/back1.webp);"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Q1ngying</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div></div></body></html>